{% set derived_description = block.body | striptags | truncate(160) if block.body else meta_description %}
{% set header_subtitle = None %}
{% if block.type == 'hero' and block.data is mapping %}
  {% set header_subtitle = block.data.get('tagline') or block.data.get('subtitle') %}
{% endif %}
{% set footer_contact = block if block.type == 'contact' else None %}
{% set page_meta = {
  'lang': block.data.language if block.data is mapping and block.data.language else 'en',
  'title': meta_title,
  'description': derived_description,
  'canonical': block.data.canonical if block.data is mapping and block.data.canonical else None,
  'open_graph': {
    'title': meta_title,
    'description': derived_description,
    'type': 'article'
  },
  'twitter': {
    'card': 'summary',
    'title': meta_title,
    'description': derived_description
  }
} %}
<!DOCTYPE html>
<html lang="{{ page_meta.lang or 'en' }}">
  {% include '_head.jinja' %}
  <body class="{{ (framework.body_class ~ ' d-flex flex-column min-vh-100 bg-body-tertiary') | trim }}">
    {% set header_title = meta_title %}
    {% include '_header.jinja' with context %}
    <main id="main-content" class="flex-grow-1 py-5">
      {% if fallback_used %}
      <div class="container mb-5">
        <div class="alert alert-warning shadow-sm" role="status">
          Automatischer LLM-Text fehlt f√ºr diese Seite. Bitte Inhalte manuell nachbearbeiten.
        </div>
      </div>
      {% endif %}
      {% set partial = section_partials.get(block.type, section_partials['text']) %}
      {% include partial with context %}
    </main>
    {% include '_footer.jinja' with context %}
    {% for src in framework.js_links %}
    <script src="{{ src }}" defer></script>
    {% endfor %}
    {% if page_meta.js_links is iterable %}
      {% for src in page_meta.js_links %}
    <script src="{{ src }}" defer></script>
      {% endfor %}
    {% endif %}
  </body>
</html>
